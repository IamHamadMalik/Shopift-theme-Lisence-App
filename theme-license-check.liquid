{% comment %}
  Theme License Protection System
  Add this code to your theme's layout/theme.liquid file
  Place it right after the opening <body> tag
{% endcomment %}

{% assign license_activated = false %}
{% assign license_error = '' %}

{% comment %} Check license status via API call {% endcomment %}
<script>
  // Check license activation status
  async function checkLicenseStatus() {
    try {
      const response = await fetch('https://shopift-theme-lisence-app.vercel.app/api/license/check?license=check&domain={{ shop.permanent_domain }}');
      const data = await response.json();
      
      if (data.success && data.activated) {
        // License is activated, hide the overlay
        const overlay = document.getElementById('theme-license-notice');
        if (overlay) {
          overlay.style.display = 'none';
        }
        return true;
      }
      return false;
    } catch (error) {
      console.error('License check failed:', error);
      return false;
    }
  }

  // Check license status when page loads
  document.addEventListener('DOMContentLoaded', function() {
    checkLicenseStatus();
  });
</script>

{% comment %} Default to showing overlay, will be hidden by JavaScript if license is valid {% endcomment %}
{% assign license_activated = false %}

{% comment %} Show license activation notice if not activated {% endcomment %}
{% unless license_activated %}
<div id="theme-license-notice" style="
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  z-index: 999999;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
">
  <div style="
    background: white;
    padding: 40px;
    border-radius: 12px;
    max-width: 500px;
    width: 90%;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  ">
    <div style="
      width: 80px;
      height: 80px;
      background: #dc3545;
      border-radius: 50%;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 36px;
    ">
      ðŸ”’
    </div>
    
    <h2 style="
      margin: 0 0 16px 0;
      color: #333;
      font-size: 24px;
      font-weight: 600;
    ">
      Theme License Not Activated
    </h2>
    
    <p style="
      margin: 0 0 24px 0;
      color: #666;
      font-size: 16px;
      line-height: 1.5;
    ">
      This premium theme requires license activation to function properly. 
      Please activate your license to unlock all features.
    </p>
    
    <div style="
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      text-align: left;
    ">
      <h4 style="margin: 0 0 12px 0; color: #333; font-size: 16px;">
        Activation Steps:
      </h4>
      <ol style="margin: 0; padding-left: 20px; color: #666; font-size: 14px;">
        <li style="margin-bottom: 8px;">Visit the license activation page</li>
        <li style="margin-bottom: 8px;">Enter your license key and shop domain</li>
        <li style="margin-bottom: 8px;">Click "Activate License"</li>
        <li>Refresh this page after activation</li>
      </ol>
    </div>
    
    <div style="
      padding: 16px;
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 6px;
      margin: 20px 0;
    ">
      <strong style="color: #856404; font-size: 14px;">
        Shop Domain: {{ shop.permanent_domain }}
      </strong>
    </div>
    
    <button onclick="window.location.reload()" style="
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 12px;
    ">
      Refresh Page
    </button>
    
    <a href="https://your-activation-site.com/activate" style="
      display: inline-block;
      background: #28a745;
      color: white;
      text-decoration: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 16px;
    ">
      Activate License
    </a>
  </div>
</div>

<script>
  // Prevent right-click and common shortcuts when license is not activated
  document.addEventListener('contextmenu', function(e) {
    e.preventDefault();
  });
  
  document.addEventListener('keydown', function(e) {
    // Disable F12, Ctrl+Shift+I, Ctrl+Shift+C, Ctrl+U
    if (e.keyCode === 123 || 
        (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 67)) ||
        (e.ctrlKey && e.keyCode === 85)) {
      e.preventDefault();
    }
  });
  
  // Check license status periodically
  setInterval(function() {
    checkLicenseStatus().then(activated => {
      if (activated) {
        // License is now activated, can optionally reload or just hide overlay
        console.log('License activated successfully!');
      }
    });
  }, 10000); // Check every 10 seconds
</script>
{% endunless %}

{% comment %} 
  Additional security: Add this CSS to hide content when JS is disabled
  Add to your theme's main CSS file:
  
  .no-js #theme-license-notice ~ * {
    display: none !important;
  }
{% endcomment %}
